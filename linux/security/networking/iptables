iptables -t table command match target/jump
	-A добавление правила в цепочку
		iptables -A INPUT -s IP -j ACCEPT
	-D удаление правила из цепочки
		iptables -D INPUT 1
		iptables -D input -p tcp --dport 80 -j DROP
	-R заменить одно правило другим
		iptables -R INPUT 1 -s 192.168.0.1 -j ACCEPT
	-I вставить новое правило в цепочку
		iptables -I INPUT 2 -p tcp --sport -j ACCEPT
	-L вывод списка правил в заданной цепочке
		iptables -L -v --line-number INPUT
	-F сброс всех правил в заданной цепочке
		iptables -F INPUT
		iptables -F tcp_filter
	-Z обнуление всех счётчиков в заданной цепочке
		iptables -Z INPUT
	-N Создание новой цепочки с заданным именем
		iptables -N tcp_filter
	-X Удаление цепочки - удаляются только пустые цепочки
		iptables X tcp_filter
	-P Политика по умолчанию для цепочки - пакет прошел все цепочки и не было найдено соответствия
		iptables -P INPUT DROP
		iptables -P OUTPUT ACCEPT
	-E переименование пользовательской цепочки
	--protocol - протокол
	service iptables save
	/etc/sysconfig/iptables
	/etc/sysconfig/iptables.config
	! - отрицание	
Фильтрация трафика, перенаправление, проброс портов, ограничение числа подключений
организация доступа в инет, установка квот трафика, фильтрация по значению ttl, выполнение правил по расписанию
Критерии отбора пакетов:
	Общие: не зависят от типа протокола и не требуют загрузки специальных модулей ядра
	Неявные: зависят от типа протокола и не требуют загрузки специальных модулей ядра
	Явные: требуют загрузки специальных модулей ядра 
Три типа таблиц:
mangle - изменение в заголовках, nat - трансляция сетевых адресов, filter - фильтрация трафика
	Mangle - 
		Действия:	
		TOS Изменит бит TOS - максимально быстрый отклик, максимальная валовая пропускная способность, гарантированная валовая пропускная способность и т.п.
		TTL Изменить поле TTL
		MARK - установить метку на пакет
		Цепочки: 
		PREROUTING используется для внесения изменений в пакеты на входе в iptables, перед принятием решения о маршрутизации.
		POSTROUTING - используется для внесения изменений в пакеты на выходе из iptables
		INPUT - изменение пакетов перед передачей их локальному приложению.
		OUTPUT - изменение пакетов после их передаче iptables
		forward - изменение транзитных пакетов
	NAT - 
		Действия:
		DNAT -  преобразование адреса назначения в заголовке пакета
			port forwarding 
				iptables -t nat -A PREROUTING -i eth1 -j DNAT --to-destination 192.168.1.1
		SNAT - изменение исходного адреса пакета
			не рекомендуется использовать, socket port - IP:PORT
		MASQUERADE - SNAT для динамических ip
			iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
				--to-ports порт или диапазон портов
		Цепочки:
		PREROUTING - пакеты на входе, изменение адреса получателя
		POSTROUTING - используется для внесения изменений в пакеты на выходе из iptables, изменение адреса отправителя
		OUTPUT - преобразование адресов в пакетах перед дальнейшей маршрутизацией
	Filter -
		Цепочки:
		INPUT - изменение пакетов перед передачей их локальному приложению.
		OUTPUT - изменение пакетов после их передаче iptables
		forward - изменение транзитных пакетов
		Действия: 
		ACCEPT - пакет прекращает движение по цепочке и считается принятым
		DROP - сброс пакета
		QUEUE  - ставит пакет в очередь пользовательскому приложению
		LOG - журналирование пакетов и событий
			iptables -A INPUT -m state --state INVALID -j LOG --log-prefix "Strange: "
		REJECT - удалённой системе будет написано, чо пакет отвергнут
		RETURN - Возврат пакета в вызывающую цепочку
		ULOG - лог в пользовательское пространство
		REDIRECT - перенаправление пакетов на другой порт
Критерии:
-p тип протокола
-s IP-адрес источника пакета
-d IP адрес получателя пакета
-j необходимое действие
-i интерфейс с которого был получен пакет
-o имя выходного интерфейса
-f правило распространяется на все фрагменты фрагментированного пакета
-m
-------------------------------------------------
limit --limit - предельное количество пакетов в единицу времени, которое способно пропустить правило
--limit-burst максимальное значение limit burst для лимита
	--limit N/s|m|h|d --limit-burst 1
		iptables -A INPUT -p icmp --icmp-type echo-request -m limit --limit 1/s --limit-burst 1 -j ACCEPT
mac --mac-source mac-адрес узла, передавшего пакет
	iptables -A INPUT -m mac --mac-source MAC -j ACCEPT
mark --mark проверка помеченных пакетов
multiport 
	--source-port список исходящих портов
	--destination-port  список входных портов
	--port и входящий, и исходящий порты
owner
	--uid-owner 
	--gid-owner
	--pid-owner
	--sid-owner
state
	--state - признак состояния соединения
		NEW - первый для данного соединения
		RELATED - связан с другим ESTABLISHED соединением
		ESTABLISHED - это не первый пакет в соединении
		INVALID - пакет не может быть идентифицирован и не может получить определённый статус
			iptables -A INPUT -m state --state INVALID -j DROP
TOS
	--tos проверка битов tos
TTL
	--ttl проверка TTL на равенство заданному числу
	Для TCP:
		--sport исходный порт
 		--dport порт на который был отправлен пакет
		--tcp-flags маска и флаги TCP пакета
		--syn пакеты с флагом SYN и без флагов ack и fin
		--tcp-option пакеты с указанным числом		
	Для UDP:
		--sport исходный порт, с которого был отправлен пакет
		--dport порт назначения
	Для ICMP
		--icmp-type тип ICMP пакета

